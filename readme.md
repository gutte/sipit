sipit
=====

A wrapper for **dpres-siptools** and file transfer to PAS environment

Features:

- One line command for the basic use case (packaging a pre-structured directory, transfer over sftp and retrieval of reports)
- Configuration file governing the main parameters
- Simple filesystem-based centralized package management and storage
- Logging


Installation
------------

1. Install [dpres-siptools](https://github.com/Digital-Preservation-Finland/dpres-siptools)
and all its dependencies, including python virtualenv.

2. Link the main binary to user path, eg. `ln -s ~/bin/sipit ./sipit.sh`
(make sure `~/bin/` is in the user $PATH). 

3. Edit the configuration file with correct parameters, and make sure
that the "package root directory" is correct and exists.

4. (optional) For automated file transfer, it is
recommended to have the ssh connection set up in `~/.ssh/config` with
a host alias and identity file. The host alias is then entered as the
`PAS_HOST` configuration parameter. For a passphrase protected identity
file it is also recommended to enable the option `USE_SSH_AGENT`, which
adds the identity to the ssh-agent when script execution begins.


Usage
-----

`sipit PACKAGE-NAME CONTENT-DIR DESCRIPTION-FILE`

- `PACKAGE-NAME`: Manually selected name of the package
- `CONTENT-DIR`: Root of the pre-structured content directory
- `DESCRIPTION-FILE`: Description file in a valid format

The content directory can be expressed relative to the cwd, but the
script is otherwise independent of the working directory.

Configuration options are described in the configuration file.


Package root directory
----------------------

All packages and metadata is moved to and managed in the **Package root
directory**. Its location is determined by the configuration
(default: `~/sipit/`).

The script creates a new "project directory" for each package.
The directory is named according to `[PACKAGE-NAME]`

### The directory has the following structure: 

- `workspace/`: Workspace used by dpres-siptools for mets file staging
- `log/`: Logfiles for the package creation and transfer
- `reports/`: Reports generated by the PAS provider after transfer
- `sip/`: Created SIP packages
